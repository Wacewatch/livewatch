<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple d'intégration iframe avec authentification</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, sans-serif;
      background: #0a0a0a;
      color: white;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 {
      margin-bottom: 20px;
    }
    iframe {
      width: 100%;
      height: 90vh;
      border: 2px solid #333;
      border-radius: 8px;
    }
    .info {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #fbbf24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Intégration LIVEWATCH en iframe</h1>
    
    <div class="info">
      <strong>Status:</strong> <span id="status">Initialisation...</span><br>
      <strong>Rôle utilisateur:</strong> <span id="role">Chargement...</span>
    </div>

    <iframe 
      id="livewatch-iframe"
      src="https://livewatch.sbs/channels/France"
      allow="autoplay; fullscreen; picture-in-picture"
      allowfullscreen
    ></iframe>
  </div>

  <script>
    // CONFIGURATION - Remplacez ces valeurs par vos vraies données utilisateur
    const USER_CONFIG = {
      role: 'admin', // Peut être: 'admin', 'vip', ou 'member'
      email: 'admin@example.com',
      isAuthenticated: true
    }

    const iframe = document.getElementById('livewatch-iframe')
    const statusEl = document.getElementById('status')
    const roleEl = document.getElementById('role')

    // Mettre à jour l'affichage
    statusEl.textContent = USER_CONFIG.isAuthenticated ? 'Connecté' : 'Non connecté'
    roleEl.textContent = USER_CONFIG.role.toUpperCase()

    // Écouter les demandes d'authentification de l'iframe
    window.addEventListener('message', (event) => {
      // Vérifier que le message vient bien de l'iframe LIVEWATCH
      if (event.origin !== 'https://livewatch.sbs') {
        return
      }

      console.log('[Parent] Message reçu de l\'iframe:', event.data)

      // L'iframe demande l'état d'authentification
      if (event.data.type === 'REQUEST_AUTH') {
        console.log('[Parent] Envoi des credentials à l\'iframe')
        
        // Envoyer les informations d'authentification à l'iframe
        iframe.contentWindow.postMessage({
          type: 'AUTH_STATE',
          role: USER_CONFIG.role,
          email: USER_CONFIG.email,
          isAuthenticated: USER_CONFIG.isAuthenticated
        }, 'https://livewatch.sbs')
        
        statusEl.textContent = 'Credentials envoyés à l\'iframe'
      }
    })

    // Envoyer l'auth automatiquement au chargement de l'iframe
    iframe.addEventListener('load', () => {
      console.log('[Parent] Iframe chargée, envoi des credentials')
      setTimeout(() => {
        iframe.contentWindow.postMessage({
          type: 'AUTH_STATE',
          role: USER_CONFIG.role,
          email: USER_CONFIG.email,
          isAuthenticated: USER_CONFIG.isAuthenticated
        }, 'https://livewatch.sbs')
      }, 500)
    })
  </script>
</body>
</html>
